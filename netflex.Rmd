---
title: "NETFLEX"
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    favicon: "flavicon.jpeg"
    logo: 
    source_code: embed
    theme: spacelab
    css: bootstrap.css
    social: [ "github","menu" ]
    vertical_layout: fill
---
```{r setup, include=FALSE}
library(shiny)
library(shinythemes)
library(shinydashboard)
library(shinydashboardPlus)
library(shinyjs)
library(shinyBS)
library(shinyLP)
library(shinycssloaders)
library(shinybusy)
library(shinyjs)
library(flexdashboard)
library(leaflet)
library(viridis)
library(shinyWidgets)
library(waiter)
library(hrbrthemes)
library(htmltools)
library(tidyverse)
library(readxl)
library(FactoMineR)
library(factoextra)
library(GGally)
library(randomForest)
library(corrplot)
library(gganimate)
library(rgdal)
library(sp)
library(rgeos)
library(scales)
library(caret)
library(e1071)
library(data.table)
library(DT)
library(dygraphs)
library(plotly)
library(xts)
library(magrittr)
```


```{r global, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
dat <- read.csv("src/data/netflex3.csv")
countriesborders <- readOGR("/srcTM_WORLD_BORDERS_SIMPL-0.3.shp")
dat$Show_type[is.na(dat$Show_type)] <- 'undefined'

genre <- paste(unlist(dat$Genre), collapse=' ')%>%
  strsplit(" ")%>%
  unlist()%>%
  sub(",$",  "", .)%>%
  table()%>%
  as.data.frame()

names(genre) <- c("Genre", "N")
  
# 
# genre2 <- dat[,c("Profile", "Genre")]%>%
#   group_by(Profile)%>%
#   mutate_at("Genre", unlist)%>%
#   mutate_at("Genre", paste, collapse = ' ')
#   mutate_at("Genre", strsplit," ")%>%
#   mutate_at("Genre", unlist)%>%
#   mutate_at("Genre", ~sub(",$",  "", .))
#   mutate_at("Genre", tally)
  
  
wordcloud(words = as.character(genre$Genre), freq = genre$N, min.freq = 1,
          max.words=25, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))

```


#  Home Page {data-orientation=rows}     
Row 
-------------------------------------

```{r}
tags$img(
     src = "bckgrnd0.jpeg",
     style = 'position: fixed'
   )
```

### ValBox {data-height=800}
```{r}
fixedPage(
  
jumbotron("Welcome to NETFLEX", "Please call attention to important application features", button =  "True", button_Label = "See Documentation")

)
```


Row {data-height=150}
-------------------------------------

Row 
-------------------------------------
```{r}


```

### Profiles
```{r}
renderValueBox({

valueBox(tags$p(length(unique(dat$Profile)),
                style = "font-size: 200%; color:	#FFFFFF;"), tags$q("Netflix Profiles",style = "font-size:                   150%; color:	#FFFFFF;") ,  color = "green", icon ="fa-users")
})

```


### Movies seen
```{r}
renderValueBox({


valueBox(tags$p(table(dat$Show_type=="movie")[2],
                style = "font-size: 200%; color:	#FFFFFF;"), tags$q("Movies seen",style = "font-size:                   150%; color:	#FFFFFF;") ,  color = "orange", icon ="fa-video")
})
```

### Series seen
```{r}
renderValueBox({
valueBox(tags$p(table(dat$Show_type=="series")[2],
                style = "font-size: 200%; color:	#FFFFFF;"), tags$q("Series seen",style = "font-size:                   150%; color:	#FFFFFF;") ,  color = "red", icon ="fa-film")
})
```

Row
-------------------------------------
```{r}

```

# Explanatory visualization {data-orientation=rows}

## Input {.sidebar}

```{r echo=FALSE}
radioButtons("time_range_1", "Time range", choices = list("All time" = 1, "Monthly" = 2, "Weekly" = 3, "Daily" = 4))
# selectInput("profile", "Choose profile",
#             choices = c(dat$Profile))
```


## Column {.tabset}
### Global
```{r echo=FALSE}

output$dygraphAllTime <- renderDygraph({

        dat_d <- dat[,c("Show_type", "Start_time")] %>%
            mutate(Date = as.Date(Start_time))%>%
            group_by(Date, Show_type)%>%
            tally()%>%
            pivot_wider(names_from = Show_type, values_from = n)%>%
            mutate_at(c('movie','series','undefined'),~replace(., is.na(.), 0))
        dat_t <-  xts(dat_d[2:4], dat_d$Date)
        dygraph(dat_t)%>%
            dyRangeSelector(dateWindow = c(min(dat$Start_time), max(dat$Start_time)))
    })

output$plotYearly <- renderPlotly({

        dat_d <- dat[,c("Show_type", "Month")] %>%
            group_by(Month, Show_type)%>%
            tally()%>%
            pivot_wider(names_from = Show_type, values_from = n)%>%
            mutate_at(c('movie','series','undefined'),~replace(., is.na(.), 0))
        dat_d$Month <- factor(dat_d$Month, levels = month.name)
        plot_ly(dat_d, x = ~Month, y = ~movie, name = "Movies", type = "bar", colors = viridis_pal(option = "D")(3))%>%
          add_trace(y = ~series, name = 'Series')%>%
          add_trace(y = ~undefined, name = 'Undefined')%>%
          layout(yaxis = list(title = 'Count'), barmode = 'group')
    })

output$plotWeekly <- renderPlotly({

        dat_d <- dat[,c("Show_type", "Day")] %>%
            group_by(Day, Show_type)%>%
            tally()%>%
            pivot_wider(names_from = Show_type, values_from = n)%>%
            mutate_at(c('movie','series','undefined'),~replace(., is.na(.), 0))
        dat_d$Day <- factor(dat_d$Day, levels = c('Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'))
        plot_ly(dat_d, x = ~Day, y = ~movie, name = "Movies", type = "bar", colors = viridis_pal(option = "D")(3))%>%
          add_trace(y = ~series, name = 'Series')%>%
          add_trace(y = ~undefined, name = 'Undefined')%>%
          layout(yaxis = list(title = 'Count'), barmode = 'group')
    })


output$plotHourly <- renderPlotly({

        dat_d <- dat[,c("Show_type", "Hours")] %>%
            group_by(Hours, Show_type)%>%
            tally()%>%
            pivot_wider(names_from = Show_type, values_from = n)%>%
            mutate_at(c('movie','series','undefined'),~replace(., is.na(.), 0))

        plot_ly(dat_d, x = ~Hours, y = ~movie, name = "Movies", type = "bar", colors = viridis_pal(option = "D")(3))%>%
          add_trace(y = ~series, name = 'Series')%>%
          add_trace(y = ~undefined, name = 'Undefined')%>%
          layout(yaxis = list(title = 'Count'), barmode = 'group')
    })





output$graph1 <- renderUI({
  if (input$time_range_1 == 1) {
    dygraphOutput("dygraphAllTime")
  } else if (input$time_range_1 == 2) {
        plotlyOutput("plotYearly")
  } else if (input$time_range_1 == 3) {
        plotlyOutput("plotWeekly")
  } else {
        plotlyOutput("plotHourly")
  }
})

uiOutput("graph1")
```

### Profile
```{r}
bar <- ggplot(dat)+
  geom_bar(mapping = aes(x = Profile, fill = Profile)) + theme_bw()
bar + coord_polar()
```

# Analysis {data-orientation=rows}

##Input {.sidebar}

```{r echo=FALSE}
radioButtons("time_range_1", "Time range", choices = list("All time" = 1, "Monthly" = 2, "Weekly" = 3, "Daily" = 4))
```

Row {.tabset}
-------------------------------------
### 1ghjk
```{r}

```

### 1ghjk
```{r}

```

### 1ghjk
```{r}

```


# Data source
```{r}
tags$style(HTML("
                    .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_filter, .dataTables_wrapper .dataTables_info, .dataTables_wrapper .dataTables_processing, .dataTables_wrapper .dataTables_paginate, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
                    color: #000000; }

                    .dataTables_wrapper .dataTables_paginate .paginate_button{box-sizing:border-box;display:inline-block;min-width:1.5em;padding:0.5em 1em;margin-left:2px;text-align:center;text-decoration:none !important;cursor:pointer;*cursor:hand;color:#ffffff !important;border:1px solid transparent;border-radius:2px}

                    .dataTables_length select {
                           color: #ffffff;
                           background-color: #ffffff
                           }
                    .dataTables_filter input {
                            color: #ffffff;
                            background-color: #ffffff}thead {
                    color: #ffffff;
                    }tbody {
                    color: #000000;
                    }"))

renderDataTable({DT::datatable(dat[,-1], options = list(scrollX = TRUE,
                 sScrollY = '75vh', scrollCollapse = TRUE), extensions = list("Scroller"))})
```


